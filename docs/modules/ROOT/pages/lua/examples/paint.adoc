
= Paint Example
:hardbreaks-option:

image::lua/examples/Example_Paint_Internal-Screen_Editor.png[ width = 300 , height = 300 , role=right ]

A small paint program utilizing the GPU & Screen.

In the lower left corner you can choose 
between 5 different colors by clicking them. 
( Red , Green , Blue , White , Transparent )

You can draw on the screen with the selected  
color by holding down your primary mouse  
button and moving your mouse around.


== Large Screen Setup

image::lua/examples/Example_Paint_Large-Screen_Hardware.png[ width = 300 , height = 300 , role=right ]

1. Place a computer case with:
    - Tier 1 CPU 
    - 1 stick of RAM 
    - Tier 1 GPU

2. Place & connect a large screen

3. Plug in an EEPROM

4. Paste the setup code + program code

5. Start the computer

[source,Lua]
----
local gpu = computer.getPCIDevices(classes.GPU_T1_C)[1]

assert(gpu,'No <GPU_T1_C> PCI device found')


local comp_screen = component.findComponent(classes.Screen)[1]

assert(comp_screen,'No <Screen> component found')


local screen = component.proxy(comp_screen)

assert(screen,'Failed to proxy <Screen> component')
----


== Internal Screen Setup

image::lua/examples/Example_Paint_Internal-Screen_Hardware.png[ width = 300 , height = 300 , role = right ]

1. Place a computer case with:
    - Tier 1 CPU 
    - 1 stick of RAM 
    - Screen Driver 
    - Tier 1 GPU

2. Plug in an EEPROM

3. Paste the setup code + program code

4. Start the computer

5. Switch to the screen tab

[source,Lua]
----
local gpu = computer.getPCIDevices(classes.GPU_T1_C)[1]

assert(gpu,'No <GPU_T1_C> PCI device found')


local screen = computer.getPCIDevices(classes.FINComputerScreen)[1]

assert(screen,'No <FINComputerScreen> PCI device found')
----

== Program Code


[source,Lua]
----
local gpu = computer.getPCIDevices(classes.GPU_T1_C)[1]

assert(gpu,'No <GPU_T1_C> PCI device found')


local screen = computer.getPCIDevices(classes.FINComputerScreen)[1]

local comp_screen = component.findComponent(classes.Screen)[1]

if comp_screen then

    screen = component.proxy(comp_screen)

    assert(screen,'Failed to proxy <Screen> component')

end

assert(screen,'No <Screen> nor <FinComputerScreen> component found')


-- [ GPU Setup ]

event.listen(gpu)
gpu:bindScreen(screen)

local width , height = gpu:getSize()

print('Screen Size',width,'x',height)


-- [ Clear Screen ]

gpu:setBackground(0,0,0,0)
gpu:fill(0,0,width,height,' ',' ')


-- [ Palette ]

colors = {
    { 1 , 0 , 0 , 1 } , { 1 , 0 , 0 , 1 } , -- Red
    { 0 , 1 , 0 , 1 } , { 0 , 1 , 0 , 1 } , -- Green
    { 0 , 0 , 1 , 1 } , { 0 , 0 , 1 , 1 } , -- Blue
    { 1 , 1 , 1 , 1 } , { 1 , 1 , 1 , 1 }   -- White
}


-- [ Draw Palette ]

for x , color in ipairs(colors) do
    gpu:setBackground(table.unpack(color))
    gpu:setText(x - 1,height - 1,' ')
end

gpu:setBackground(1,1,1,1)


local isDown = false

--
--  If over palette try to select 
--  color or fallback to transparent
--
--  Otherwise start mouse holding
--
local function onMouseDown ( x , y )
    if y == height - 1 then
  
        color = colors[ x + 1 ] or { 0 , 0 , 0 , 0 }
        gpu:setBackground(table.unpack(color))
    
    else
        isDown = true
    end
end


--
--  End mouse holding on release
--
local function onMouseUp ()
    isDown = false
end


--
--  Draw pixel with selected color
--  if primary mouse button is held
--  and not hovered over palette row
--
local function onMouseMove ( x , y )
    if not isDown then
        return
    end
    
    if y == height - 1 then
        return
    end
    
    gpu:setText(x,y,' ')
end


local events = {
    OnMouseMove = onMouseMove ,
    OnMouseDown = onMouseDown ,
    OnMouseUp = onMouseUp 
}


while true do
 
    local event , target , x , y = event.pull()
    
    if events[ event ] then
        events[ event ](x,y)
    end
    
    gpu:flush()
end
----

include::partial$lua_examples_footer.adoc[]